#include "bs.h" 
#include "utl/mybpf_regs.h" 
#include "utl/mybpf_asmdef.h" 
#include "utl/bpfasm_utl.h" 

static BPFASM_FUNC_S g_bpfasm_progs[] = { 
    {.func_name="MYBPF_PROG_ConvertCtxAccess", .insn_offset=0}, 
    {0} }; 

static MYBPF_INSN_S g_bpfasm_insts[] = { 
    /* MYBPF_PROG_ConvertCtxAccess */
    BPF_LDX_MEM(BPF_DW, BPF_R2, BPF_R1, 224), 
    BPF_LDX_MEM(BPF_W, BPF_R1, BPF_R1, 220), 
    BPF_MOV64_IMM(BPF_R3, 0), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -8), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -24), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -32), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -40), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -48), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -56), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -64), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -72), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -80), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -88), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -96), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -104), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -112), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -120), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -128), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -136), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -144), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -152), 
    BPF_STX_MEM(BPF_DW, BPF_R10, BPF_R3, -168), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R3, -176), 
    BPF_MOV64_IMM(BPF_R4, 2), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R4, -160), 
    BPF_MOV64_IMM(BPF_R5, 6), 
    BPF_STX_MEM(BPF_W, BPF_R10, BPF_R5, -16), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R1, 32), 
    BPF_MOV64_REG(BPF_R5, BPF_R1), 
    BPF_ALU64_IMM(BPF_ARSH, BPF_R5, 32), 
    BPF_MOV64_IMM(BPF_R0, 8), 
    BPF_JMP_REG(BPF_JSGT, BPF_R0, BPF_R5, 13), 
    BPF_ALU64_IMM(BPF_ARSH, BPF_R1, 35), 
    BPF_LD_IMM64_RAW(BPF_R5, BPF_R0, 0x100000000LL), 
    BPF_MOV64_IMM(BPF_R0, 0), 
    BPF_JMP_A(10), 
    BPF_ALU64_REG(BPF_ADD, BPF_R0, BPF_R6), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R0, 32), 
    BPF_ALU64_REG(BPF_ADD, BPF_R0, BPF_R5), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R6, 3), 
    BPF_ALU64_REG(BPF_ADD, BPF_R2, BPF_R6), 
    BPF_ALU64_IMM(BPF_ADD, BPF_R2, 8), 
    BPF_ALU64_IMM(BPF_ARSH, BPF_R0, 32), 
    BPF_JMP_REG(BPF_JSGT, BPF_R1, BPF_R0, 2), 
    BPF_MOV64_IMM(BPF_R0, 0), 
    BPF_EXIT_INSN(), 
    BPF_LDX_MEM(BPF_B, BPF_R6, BPF_R2, 0), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_ALU64_IMM(BPF_AND, BPF_R7, 7), 
    BPF_JMP_REG(BPF_JGT, BPF_R4, BPF_R7, 14), 
    BPF_JMP_IMM(BPF_JEQ, BPF_R7, 7, 1), 
    BPF_JMP_IMM(BPF_JNE, BPF_R7, 4, 20), 
    BPF_MOV64_IMM(BPF_R8, 1), 
    BPF_LDX_MEM(BPF_B, BPF_R7, BPF_R2, 1), 
    BPF_MOV64_REG(BPF_R9, BPF_R6), 
    BPF_ALU64_IMM(BPF_AND, BPF_R9, 248), 
    BPF_JMP_IMM(BPF_JNE, BPF_R9, 184, 9), 
    BPF_MOV64_REG(BPF_R8, BPF_R7), 
    BPF_ALU64_IMM(BPF_AND, BPF_R8, 240), 
    BPF_MOV64_REG(BPF_R9, BPF_R10), 
    BPF_ALU64_IMM(BPF_ADD, BPF_R9, -176), 
    BPF_ALU64_REG(BPF_ADD, BPF_R9, BPF_R8), 
    BPF_LDX_MEM(BPF_W, BPF_R8, BPF_R9, 0), 
    BPF_JMP_A(2), 
    BPF_MOV64_IMM(BPF_R8, 1), 
    BPF_LDX_MEM(BPF_B, BPF_R7, BPF_R2, 1), 
    BPF_ALU64_IMM(BPF_AND, BPF_R7, 15), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R7, 4), 
    BPF_MOV64_REG(BPF_R9, BPF_R10), 
    BPF_ALU64_IMM(BPF_ADD, BPF_R9, -176), 
    BPF_ALU64_REG(BPF_ADD, BPF_R9, BPF_R7), 
    BPF_STX_MEM(BPF_W, BPF_R9, BPF_R8, 0), 
    BPF_LDX_MEM(BPF_B, BPF_R7, BPF_R2, 1), 
    BPF_ALU64_IMM(BPF_AND, BPF_R7, 240), 
    BPF_MOV64_REG(BPF_R8, BPF_R10), 
    BPF_ALU64_IMM(BPF_ADD, BPF_R8, -176), 
    BPF_ALU64_REG(BPF_ADD, BPF_R8, BPF_R7), 
    BPF_LDX_MEM(BPF_W, BPF_R8, BPF_R8, 0), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_JMP_IMM(BPF_JNE, BPF_R8, 2, 50), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_ALU64_IMM(BPF_ADD, BPF_R7, -97), 
    BPF_MOV64_REG(BPF_R8, BPF_R7), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R8, 7), 
    BPF_ALU64_IMM(BPF_AND, BPF_R7, 254), 
    BPF_ALU64_IMM(BPF_RSH, BPF_R7, 1), 
    BPF_ALU64_REG(BPF_OR, BPF_R8, BPF_R7), 
    BPF_ALU64_IMM(BPF_AND, BPF_R8, 255), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_JMP_IMM(BPF_JGT, BPF_R8, 13, 40), 
    BPF_MOV64_IMM(BPF_R9, 1), 
    BPF_ALU64_REG(BPF_LSH, BPF_R9, BPF_R8), 
    BPF_ALU64_IMM(BPF_AND, BPF_R9, 13107), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_JMP_IMM(BPF_JNE, BPF_R9, 0, 1), 
    BPF_JMP_A(34), 
    BPF_LDX_MEM(BPF_H, BPF_R7, BPF_R2, 2), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R7, 48), 
    BPF_ALU64_IMM(BPF_ARSH, BPF_R7, 48), 
    BPF_MOV64_REG(BPF_R8, BPF_R7), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R8, 30), 
    BPF_ALU64_IMM(BPF_RSH, BPF_R7, 2), 
    BPF_ALU64_IMM(BPF_AND, BPF_R7, 1073741823), 
    BPF_ALU64_REG(BPF_OR, BPF_R8, BPF_R7), 
    BPF_ALU64_IMM(BPF_LSH, BPF_R8, 32), 
    BPF_ALU64_IMM(BPF_RSH, BPF_R8, 32), 
    BPF_JMP_IMM(BPF_JSGT, BPF_R8, 1, 9), 
    BPF_MOV64_IMM(BPF_R9, 0), 
    BPF_MOV64_IMM(BPF_R7, 121), 
    BPF_JMP_IMM(BPF_JEQ, BPF_R8, 0, 17), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_JMP_IMM(BPF_JEQ, BPF_R8, 1, 1), 
    BPF_JMP_A(17), 
    BPF_MOV64_IMM(BPF_R9, 8), 
    BPF_MOV64_IMM(BPF_R7, 121), 
    BPF_JMP_A(11), 
    BPF_JMP_IMM(BPF_JEQ, BPF_R8, 4, 6), 
    BPF_JMP_IMM(BPF_JEQ, BPF_R8, 3, 7), 
    BPF_MOV64_REG(BPF_R7, BPF_R6), 
    BPF_JMP_IMM(BPF_JNE, BPF_R8, 2, 10), 
    BPF_MOV64_IMM(BPF_R9, 16), 
    BPF_MOV64_IMM(BPF_R7, 121), 
    BPF_JMP_A(4), 
    BPF_MOV64_IMM(BPF_R9, 28), 
    BPF_JMP_A(1), 
    BPF_MOV64_IMM(BPF_R9, 24), 
    BPF_MOV64_IMM(BPF_R7, 97), 
    BPF_STX_MEM(BPF_W, BPF_R2, BPF_R3, 4), 
    BPF_STX_MEM(BPF_H, BPF_R2, BPF_R9, 2), 
    BPF_STX_MEM(BPF_B, BPF_R2, BPF_R7, 0), 
    BPF_ALU64_IMM(BPF_AND, BPF_R7, 29), 
    BPF_MOV64_IMM(BPF_R6, 1), 
    BPF_JMP_IMM(BPF_JEQ, BPF_R7, 24, -97), 
    BPF_MOV64_IMM(BPF_R6, 0), 
    BPF_JMP_A(-99), 
}; 

static BPFASM_S g_bpfasm_ctrl = { 
    .funcs = g_bpfasm_progs, 
    .begin_addr = g_bpfasm_insts, 
    .end_addr = (char*)(void*)g_bpfasm_insts + sizeof(g_bpfasm_insts)
}; 

U64 MYBPF_PROG_ConvertCtxAccess(U64 p1, U64 p2, U64 p3, U64 p4, U64 p5) 
{ 
    U64 bpf_ret; 
    MYBPF_PARAM_S p; 
    p.p[0]=p1; p.p[1]=p2; p.p[2]=p3; p.p[3]=p4; p.p[4]=p5; 
    int ret = BPFASM_Run(&g_bpfasm_ctrl, "MYBPF_PROG_ConvertCtxAccess", &bpf_ret, &p); 
    if (ret < 0) return ret; 
    return bpf_ret; 
} 

